{"version":3,"file":"index.js","sources":["../src/matcher.js","../src/index.js"],"sourcesContent":["const split = str => {\n    if (!str.includes(\"/\")) return str;\n    if (str.charAt(0) === \"/\") return str.substring(1).split(\"/\");\n    return str.split(\"/\");\n}\n\nconst matcher = (patterns, targetRoute) => {\n  const exactMatch = patterns.find(({ path }) => path === targetRoute);\n  const wildcard = patterns.find(pattern => pattern.path === '*');\n  if (exactMatch) return { route: exactMatch, props: null };\n  const targetParts = split(targetRoute);\n  const props = {};\n  const route = patterns.find(({ path }) => {\n    const patternParts = split(path);\n    if( (patternParts.length !== targetParts.length) || patternParts[0].includes(\":\") ) return false;\n    const matches = [];    \n    patternParts.forEach((part, i) => {\n        if (patternParts[i] && patternParts[i].includes(\":\")) {\n            props[patternParts[i].replace(\":\", \"\")] = targetParts[i];\n            matches.push(true);\n        } else {\n            matches.push(part === targetParts[i]);\n        }\n    });\n    return matches.every(match => match === true);\n  });\n\n  if(!route && wildcard) return { route: wildcard };\n  if(!route && !wildcard) return null;\n  return { route, props };\n};\n\nexport default matcher;\nexport { matcher };\n","import { matcher } from './matcher';\n\nconst DCE = document.createElement.bind(document);\nconst HPS = history.pushState.bind(history);\nconst HRS = history.replaceState.bind(history);\nconst WRE = window.removeEventListener.bind(window);\nconst WDE = window.dispatchEvent.bind(window);\nconst WAE = window.addEventListener.bind(window);\n\nconst Errors = {\n  Router: {\n    NoRoutes: \"Router :: No routes were defined!\"\n  },\n  RouteMixin: {\n    NoRoute:\n      \"RouteMixin :: `navigate` method requires the ### component to have a route property/attribute\"\n  }\n};\n\nconst startLocation = () => window.location.pathname || \"/\";\n\nconst Router = superClass =>\n  class extends superClass {\n    static get properties() {\n      return {\n        routes: Array,\n        route: String,\n        routeProps: Object,\n        routeElement: String,\n        lastRoute: String\n      };\n    }\n    constructor() {\n      super();\n      const route = startLocation();\n      this.routeProps = {};\n      this.lastRoute = null;\n      HRS({ route }, null, route);\n    }\n    connectedCallback() {\n      super.connectedCallback();\n      WAE(\"popstate\", this.__handleNav.bind(this));\n      WDE(new PopStateEvent(\"popstate\", { state: { route: startLocation() } }));\n    }\n    disconnectedCallback() {\n      super.disconnectedCallback();\n      WRE(\"popstate\", this.__handleNav.bind(this));\n    }\n    __handleNav(ev) {\n      if (!this.constructor.routes) throw Errors.Router.NoRoutes;\n      const targetRoute = ev.state.route;\n      const match = matcher(this.constructor.routes, targetRoute);\n      if (match) {\n        this.route = match.route;\n        this.routeProps = match.props;\n      }\n      if (this.lastRoute !== targetRoute) {\n        this.setRouteElement();\n        this.lastRoute = targetRoute;\n      }\n    }\n    setRouteElement() {\n      const setElement = () => {\n        let element;\n        if( typeof this.route.render === \"function\" ) {\n          element = this.route.render(this.routeProps);\n        } else {\n          element = DCE(this.route.component);\n          Object.assign(element, this.routeProps);\n        }\n        \n        this.routeElement = element;\n      };\n      if (!this.route) {\n        this.routeElement = null;\n      } else if (\n        !customElements.get(this.route.component) &&\n        typeof this.route.import === \"function\"\n      ) {\n        this.route.import().then(setElement);\n      } else {\n        setElement();\n      }\n    }\n  };\n\nconst RouteMixin = superClass =>\n  class extends superClass {\n    static get properties() {\n      return {\n        isRouteActive: Boolean\n      };\n    }\n    connectedCallback() {\n      super.connectedCallback();\n      this.isRouteActive = this.route === window.location.pathname;\n      WAE(\"popstate\", this.__handleActive.bind(this));\n    }\n    disconnectedCallback() {\n      super.disconnectedCallback();\n      WRE(\"popstate\", this.__handleActive.bind(this));\n    }\n    __handleActive(ev) {\n      this.isRouteActive = ev.state.route === this.route;\n    }\n    navigate( customRoute ) {\n      const route = customRoute ? customRoute : this.route;\n      if (!route) throw Errors.RouteMixin.NoRoute.replace('###', this.nodeName);\n      if (route === window.location.pathname) return;\n      if (route.substring(0, 1) !== '/') {\n        window.location.href = route;\n        return;\n      }\n\n      const state = { route };\n      HPS(state, null, route);\n      WDE(new PopStateEvent(\"popstate\", { state }));\n    }\n  };\n\nexport { Router, RouteMixin };\n"],"names":["split","str","includes","charAt","substring","DCE","document","createElement","bind","HPS","history","pushState","HRS","replaceState","WRE","window","removeEventListener","WDE","dispatchEvent","WAE","addEventListener","Errors","Router","NoRoutes","RouteMixin","NoRoute","startLocation","location","pathname","superClass","properties","isRouteActive","Boolean","[object Object]","super","connectedCallback","this","route","__handleActive","disconnectedCallback","ev","state","customRoute","replace","nodeName","href","PopStateEvent","routes","Array","String","routeProps","Object","routeElement","lastRoute","__handleNav","constructor","targetRoute","match","patterns","exactMatch","find","path","wildcard","pattern","props","targetParts","patternParts","length","matches","forEach","part","i","push","every","matcher","setRouteElement","setElement","element","render","component","assign","customElements","get","import","then"],"mappings":"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"}