{"version":3,"file":"index.m.js","sources":["../src/matcher.js","../src/index.js"],"sourcesContent":["const split = str => {\n    if (!str.includes(\"/\")) return str;\n    if (str.charAt(0) === \"/\") return str.substring(1).split(\"/\");\n    return str.split(\"/\");\n}\n\nconst matcher = (patterns, targetRoute) => {\n  const exactMatch = patterns.find(({ path }) => path === targetRoute);\n  const wildcard = patterns.find(pattern => pattern.path === '*');\n  if (exactMatch) return { route: exactMatch, props: null };\n  const targetParts = split(targetRoute);\n  const props = {};\n  const route = patterns.find(({ path }) => {\n    const patternParts = split(path);\n    if( (patternParts.length !== targetParts.length) || patternParts[0].includes(\":\") ) return false;\n    const matches = [];    \n    patternParts.forEach((part, i) => {\n        if (patternParts[i] && patternParts[i].includes(\":\")) {\n            props[patternParts[i].replace(\":\", \"\")] = targetParts[i];\n            matches.push(true);\n        } else {\n            matches.push(part === targetParts[i]);\n        }\n    });\n    return matches.every(match => match === true);\n  });\n\n  if(!route && wildcard) return { route: wildcard };\n  if(!route && !wildcard) return null;\n  return { route, props };\n};\n\nexport default matcher;\nexport { matcher };\n","import { matcher } from './matcher';\n\nconst DCE = document.createElement.bind(document);\nconst HPS = history.pushState.bind(history);\nconst HRS = history.replaceState.bind(history);\nconst WRE = window.removeEventListener.bind(window);\nconst WDE = window.dispatchEvent.bind(window);\nconst WAE = window.addEventListener.bind(window);\n\nconst Errors = {\n  Router: {\n    NoRoutes: \"Router :: No routes were defined!\"\n  },\n  RouteMixin: {\n    NoRoute:\n      \"RouteMixin :: `navigate` method requires the ### component to have a route property/attribute\"\n  }\n};\n\nconst startLocation = () => window.location.pathname || \"/\";\n\nconst Router = superClass =>\n  class extends superClass {\n    static get properties() {\n      return {\n        routes: Array,\n        route: String,\n        routeProps: Object,\n        routeElement: String,\n        lastRoute: String\n      };\n    }\n    constructor() {\n      super();\n      const route = startLocation();\n      this.routeProps = {};\n      this.lastRoute = null;\n      HRS({ route }, null, route);\n    }\n    connectedCallback() {\n      super.connectedCallback();\n      WAE(\"popstate\", this.__handleNav.bind(this));\n      WDE(new PopStateEvent(\"popstate\", { state: { route: startLocation() } }));\n    }\n    disconnectedCallback() {\n      super.disconnectedCallback();\n      WRE(\"popstate\", this.__handleNav.bind(this));\n    }\n    __handleNav(ev) {\n      if (!this.constructor.routes) throw Errors.Router.NoRoutes;\n      const targetRoute = ev.state.route;\n      const match = matcher(this.constructor.routes, targetRoute);\n      if (match) {\n        this.route = match.route;\n        this.routeProps = match.props;\n      }\n      if (this.lastRoute !== targetRoute) {\n        this.setRouteElement();\n        this.lastRoute = targetRoute;\n      }\n    }\n    setRouteElement() {\n      const setElement = () => {\n        let element;\n        if( typeof this.route.render === \"function\" ) {\n          element = this.route.render(this.routeProps);\n        } else {\n          element = DCE(this.route.component);\n          Object.assign(element, this.routeProps);\n        }\n        \n        this.routeElement = element;\n      };\n      if (!this.route) {\n        this.routeElement = null;\n      } else if (\n        !customElements.get(this.route.component) &&\n        typeof this.route.import === \"function\"\n      ) {\n        this.route.import().then(setElement);\n      } else {\n        setElement();\n      }\n    }\n  };\n\nconst RouteMixin = superClass =>\n  class extends superClass {\n    static get properties() {\n      return {\n        isRouteActive: Boolean\n      };\n    }\n    connectedCallback() {\n      super.connectedCallback();\n      this.isRouteActive = this.route === window.location.pathname;\n      WAE(\"popstate\", this.__handleActive.bind(this));\n    }\n    disconnectedCallback() {\n      super.disconnectedCallback();\n      WRE(\"popstate\", this.__handleActive.bind(this));\n    }\n    __handleActive(ev) {\n      this.isRouteActive = ev.state.route === this.route;\n    }\n    navigate( customRoute ) {\n      const route = customRoute ? customRoute : this.route;\n      if (!route) throw Errors.RouteMixin.NoRoute.replace('###', this.nodeName);\n      if (route === window.location.pathname) return;\n      if (route.substring(0, 1) !== '/') {\n        window.location.href = route;\n        return;\n      }\n\n      const state = { route };\n      HPS(state, null, route);\n      WDE(new PopStateEvent(\"popstate\", { state }));\n    }\n  };\n\nexport { Router, RouteMixin };\n"],"names":["split","str","includes","charAt","substring","DCE","document","createElement","bind","HPS","history","pushState","HRS","replaceState","WRE","window","removeEventListener","WDE","dispatchEvent","WAE","addEventListener","Errors","Router","NoRoutes","RouteMixin","NoRoute","startLocation","location","pathname","superClass","properties","routes","Array","route","String","routeProps","Object","routeElement","lastRoute","[object Object]","super","this","connectedCallback","__handleNav","PopStateEvent","state","disconnectedCallback","ev","constructor","targetRoute","match","patterns","exactMatch","find","path","wildcard","pattern","props","targetParts","patternParts","length","matches","forEach","part","i","replace","push","every","matcher","setRouteElement","setElement","element","render","component","assign","customElements","get","import","then","isRouteActive","Boolean","__handleActive","customRoute","nodeName","href"],"mappings":"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"}